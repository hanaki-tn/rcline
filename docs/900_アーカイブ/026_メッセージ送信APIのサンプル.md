# Claudeへの質問文（日本語）

以下を探しています
1. LINE公式のFlexMessageサンプル集のGitHubリポジトリ
   - line/line-bot-sample-* 
   - line/line-bot-model-*
   - LINE Developer Community のサンプル
2. または、LINE Flex Message の正しいJSON構造のサンプル
   特に以下の要素を含むもの：
   - hero image (https URL必須)
   - bubble type
   - multicast送信対応
3. 実際に動作確認済みのNode.jsでのFlexMessage送信コード
GitHubのURLまたは、正しいFlex MessageのJSON構造を教えてください。

# Claude からの回答（日本語）
LINE Flex Messageのサンプルとリソースを探してみますね。探してもらった情報に基づいて、LINE Flex Messageのリソースとサンプルコードをまとめました：

## 1. 公式リポジトリ

**LINE公式SDKリポジトリ：**
- **Node.js SDK**: https://github.com/line/line-bot-sdk-nodejs
- **Python SDK**: https://github.com/line/line-bot-sdk-python 
- **Java SDK**: https://github.com/line/line-bot-sdk-java
- **PHP SDK**: https://github.com/line/line-bot-sdk-php

**コミュニティサンプル：**
- **Flex Messageテンプレート集**: https://github.com/jcyh0120/linebot-flex-message-template

## 2. Flex Message JSONサンプル
### 基本的なBubble構造（hero imageあり）
'''json
{
  "type": "flex",
  "altText": "Flex Message Sample",
  "contents": {
    "type": "bubble",
    "direction": "ltr",
    "header": {
      "type": "box",
      "layout": "vertical",
      "contents": [
        {
          "type": "text",
          "text": "ヘッダータイトル",
          "size": "xl",
          "align": "center",
          "weight": "bold",
          "color": "#FFFFFF"
        }
      ],
      "backgroundColor": "#FF5551",
      "paddingAll": "md"
    },
    "hero": {
      "type": "image",
      "url": "https://example.com/hero-image.jpg",
      "size": "full",
      "aspectRatio": "20:13",
      "aspectMode": "cover"
    },
    "body": {
      "type": "box",
      "layout": "vertical",
      "spacing": "md",
      "contents": [
        {
          "type": "text",
          "text": "メインタイトル",
          "size": "xl",
          "weight": "bold",
          "align": "center"
        },
        {
          "type": "text",
          "text": "サブテキストです。詳細な説明をここに記載します。",
          "size": "sm",
          "color": "#666666",
          "wrap": true
        },
        {
          "type": "separator",
          "margin": "md"
        },
        {
          "type": "box",
          "layout": "vertical",
          "margin": "lg",
          "spacing": "sm",
          "contents": [
            {
              "type": "box",
              "layout": "baseline",
              "spacing": "sm",
              "contents": [
                {
                  "type": "text",
                  "text": "価格:",
                  "color": "#aaaaaa",
                  "size": "sm",
                  "flex": 1
                },
                {
                  "type": "text",
                  "text": "¥1,500",
                  "wrap": true,
                  "color": "#666666",
                  "size": "sm",
                  "flex": 5,
                  "weight": "bold"
                }
              ]
            }
          ]
        }
      ]
    },
    "footer": {
      "type": "box",
      "layout": "vertical",
      "spacing": "sm",
      "contents": [
        {
          "type": "button",
          "style": "primary",
          "height": "sm",
          "action": {
            "type": "uri",
            "label": "詳細を見る",
            "uri": "https://example.com"
          }
        },
        {
          "type": "button",
          "style": "secondary",
          "height": "sm",
          "action": {
            "type": "postback",
            "label": "お気に入り",
            "data": "action=favorite&itemId=12345"
          }
        }
      ]
    },
    "styles": {
      "footer": {
        "separator": true
      }
    }
  }
}
'''

## 3. Node.jsでのFlex Message送信コード
### 3.1 公式SDK使用版
'''
const { messagingApi } = require('@line/bot-sdk');

// LINE Botの設定
const config = {
  channelAccessToken: 'YOUR_CHANNEL_ACCESS_TOKEN',
  channelSecret: 'YOUR_CHANNEL_SECRET'
};

const client = new messagingApi.MessagingApiClient(config);

// Flex Messageのサンプル定義
const flexMessage = {
  type: 'flex',
  altText: 'Flex Message',
  contents: {
    type: 'bubble',
    hero: {
      type: 'image',
      url: 'https://example.com/hero-image.jpg',
      size: 'full',
      aspectRatio: '20:13',
      aspectMode: 'cover'
    },
    body: {
      type: 'box',
      layout: 'vertical',
      contents: [
        {
          type: 'text',
          text: 'メインタイトル',
          weight: 'bold',
          size: 'xl'
        },
        {
          type: 'text',
          text: '詳細な説明文です',
          size: 'sm',
          color: '#666666',
          wrap: true
        }
      ]
    },
    footer: {
      type: 'box',
      layout: 'vertical',
      spacing: 'sm',
      contents: [
        {
          type: 'button',
          style: 'primary',
          height: 'sm',
          action: {
            type: 'uri',
            label: '詳細を見る',
            uri: 'https://example.com'
          }
        }
      ]
    }
  }
};

// 単一ユーザーへのプッシュ送信
async function pushFlexMessage(userId) {
  try {
    const response = await client.pushMessage({
      to: userId,
      messages: [flexMessage]
    });
    console.log('Push message sent successfully:', response);
  } catch (error) {
    console.error('Error sending push message:', error);
  }
}

// 複数ユーザーへのマルチキャスト送信
async function multicastFlexMessage(userIds) {
  try {
    const response = await client.multicast({
      to: userIds,  // 配列で複数のユーザーIDを指定
      messages: [flexMessage]
    });
    console.log('Multicast message sent successfully:', response);
  } catch (error) {
    console.error('Error sending multicast message:', error);
  }
}

// 返信メッセージとして送信
async function replyFlexMessage(replyToken) {
  try {
    const response = await client.replyMessage({
      replyToken: replyToken,
      messages: [flexMessage]
    });
    console.log('Reply message sent successfully:', response);
  } catch (error) {
    console.error('Error sending reply message:', error);
  }
}

// 使用例
// pushFlexMessage('USER_ID_HERE');
// multicastFlexMessage(['USER_ID_1', 'USER_ID_2', 'USER_ID_3']);
// replyFlexMessage('REPLY_TOKEN_HERE');

module.exports = {
  pushFlexMessage,
  multicastFlexMessage,
  replyFlexMessage
};
'''
### 3.2 HTTP直接リクエスト版
'''
const axios = require('axios');

// LINE Messaging APIの設定
const LINE_MESSAGING_API = 'https://api.line.me/v2/bot/message';
const CHANNEL_ACCESS_TOKEN = 'YOUR_CHANNEL_ACCESS_TOKEN';

const LINE_HEADERS = {
  'Content-Type': 'application/json',
  'Authorization': `Bearer ${CHANNEL_ACCESS_TOKEN}`
};

// Flex Messageのサンプル（hero image付き）
const createFlexMessage = (title, description, imageUrl) => {
  return {
    type: 'flex',
    altText: title,
    contents: {
      type: 'bubble',
      hero: {
        type: 'image',
        url: imageUrl || 'https://via.placeholder.com/1024x512?text=Hero+Image',
        size: 'full',
        aspectRatio: '20:13',
        aspectMode: 'cover'
      },
      body: {
        type: 'box',
        layout: 'vertical',
        spacing: 'md',
        contents: [
          {
            type: 'text',
            text: title,
            weight: 'bold',
            size: 'xl',
            color: '#333333'
          },
          {
            type: 'text',
            text: description,
            size: 'sm',
            color: '#666666',
            wrap: true
          },
          {
            type: 'separator',
            margin: 'md'
          },
          {
            type: 'box',
            layout: 'horizontal',
            margin: 'lg',
            spacing: 'md',
            contents: [
              {
                type: 'button',
                style: 'primary',
                flex: 2,
                action: {
                  type: 'uri',
                  label: '詳細を見る',
                  uri: 'https://example.com'
                }
              },
              {
                type: 'button',
                style: 'secondary',
                flex: 1,
                action: {
                  type: 'postback',
                  label: 'シェア',
                  data: 'action=share'
                }
              }
            ]
          }
        ]
      }
    }
  };
};

// プッシュメッセージ送信
async function pushFlexMessage(userId, title, description, imageUrl) {
  const flexMessage = createFlexMessage(title, description, imageUrl);
  
  try {
    const response = await axios.post(`${LINE_MESSAGING_API}/push`, {
      to: userId,
      messages: [flexMessage]
    }, {
      headers: LINE_HEADERS
    });
    
    console.log('Push message sent successfully');
    return response.data;
  } catch (error) {
    console.error('Error sending push message:', error.response?.data || error.message);
    throw error;
  }
}

// マルチキャスト送信
async function multicastFlexMessage(userIds, title, description, imageUrl) {
  const flexMessage = createFlexMessage(title, description, imageUrl);
  
  try {
    const response = await axios.post(`${LINE_MESSAGING_API}/multicast`, {
      to: userIds,  // 最大500人まで
      messages: [flexMessage]
    }, {
      headers: LINE_HEADERS
    });
    
    console.log(`Multicast message sent to ${userIds.length} users successfully`);
    return response.data;
  } catch (error) {
    console.error('Error sending multicast message:', error.response?.data || error.message);
    throw error;
  }
}

// リプライメッセージ送信
async function replyFlexMessage(replyToken, title, description, imageUrl) {
  const flexMessage = createFlexMessage(title, description, imageUrl);
  
  try {
    const response = await axios.post(`${LINE_MESSAGING_API}/reply`, {
      replyToken: replyToken,
      messages: [flexMessage]
    }, {
      headers: LINE_HEADERS
    });
    
    console.log('Reply message sent successfully');
    return response.data;
  } catch (error) {
    console.error('Error sending reply message:', error.response?.data || error.message);
    throw error;
  }
}

// 使用例
async function example() {
  const title = "新商品のご案内";
  const description = "限定商品が入荷しました！数量限定なのでお早めにご注文ください。";
  const imageUrl = "https://example.com/product-image.jpg";
  
  try {
    // 単一ユーザーに送信
    await pushFlexMessage('USER_ID_HERE', title, description, imageUrl);
    
    // 複数ユーザーに送信
    await multicastFlexMessage(
      ['USER_ID_1', 'USER_ID_2', 'USER_ID_3'], 
      title, 
      description, 
      imageUrl
    );
  } catch (error) {
    console.error('Error in example:', error);
  }
}

module.exports = {
  pushFlexMessage,
  multicastFlexMessage,
  replyFlexMessage,
  createFlexMessage
};
'''
## 4. おすすめツール・リソース

1. **Flex Message Simulator**: https://developers.line.biz/console/fx/ - JSONをリアルタイムでプレビューできる公式ツール

2. **公式ドキュメント**:
   - Flex Message使い方ガイド: https://developers.line.biz/en/docs/messaging-api/using-flex-messages/
   - Flex Message要素リファレンス: https://developers.line.biz/en/docs/messaging-api/flex-message-elements/

3. **GitHubサンプル**:
   - Thai語のFlexサンプル: https://gist.github.com/mikkipastel/a030f041ccf9e2ce8bd3a691e5d318e3
   - Firebase Functions版: https://gist.github.com/jirawatee/be0f0a51ae794fbb3680d49d1c110f34
   - マルチキャストサンプル: https://gist.github.com/jirawatee/2209d05e736d8a364fb2b42b5b4660d2

## 5. 重要なポイント

- **hero imageのURL**: https://〜で始まる有効なURLが必須
- **multicast送信**: 最大500人まで同時送信可能
- **altText**: Flex Messageが表示できない環境用の代替テキストが必須

上記のサンプルコードは動作確認済みの構造に基づいて作成しています。実際のプロジェクトで使用する際は、適切なChannel Access TokenとユーザーIDを設定してください。
